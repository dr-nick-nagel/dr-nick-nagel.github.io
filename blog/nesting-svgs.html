<!DOCTYPE html>
<html lang="en">
    <head>
          <title>NickNagel.com - More on SVG Viewports: Nesting SVG's</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script>
            MathJax = {
                tex: {
                    inlineMath: [['$', '$'], ['\\(', '\\)']]
                }
            };
        </script>
        <script 
            id="MathJax-script" 
            async 
            src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
        ></script>
        
          <script src='/scripts/dist_carousel/main.js' type="module"></script>

        
        <link 
            rel="stylesheet" 
            type="text/css" 
            href="https://dr-nick-nagel.github.io/theme/css/styles.css" />
        <link 
            rel="stylesheet" 
            type="text/css" 
            href="https://dr-nick-nagel.github.io/theme/css/admonitions.css" />
        <link 
            rel="stylesheet" 
            href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" />




    <meta name="tags" content="javascript" />
    <meta name="tags" content="animation" />
    <meta name="tags" content="svg" />
    <meta name="tags" content="scalable vector graphics" />
    <meta name="tags" content="art" />
    <meta name="tags" content="artwork" />
    <meta name="tags" content="HTML5" />
    <meta name="tags" content="artworks" />
    <meta name="tags" content="framework" />
    <meta name="tags" content="SVG Arists Collaborative" />
    <meta name="tags" content="Inkscape" />
    <meta name="tags" content="Illustrator" />
    <meta name="tags" content="Adobe" />

    </head>

    <body>

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg id="nn_symbols"
   version="1.1"
   style="display:none"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg">
   <defs>
    <symbol id="en_return"  viewBox="0 0 20 20">
      <path
        style="fill:#c83737;stroke:#751212;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
        d="M 9.6379516,18.516453 C 8.0412156,15.235727 5.9327077,14.722427 3.8797118,13.908944 L 9.6622123,2.3464436 15.149901,13.929683 c -2.648024,0.824695 -4.265949,1.397854 -5.5119494,4.58677 z"
        id="return_to_text_1"
      />
    </symbol>
   </defs>
</svg>
        <div class='banner'>
Welcome to NickNagel.com
        </div>
        <div class="container">
            <navbar class="navigation">
                <div class='image_item' id="pallas-athena-container">
                    <img id="pallas-athena-image"
                        src="https://dr-nick-nagel.github.io/images/athena.svg" 
                        alt="Pallas Athena"
                    >
                </div>
                <ul>
                    <li>
                        <a href="https://dr-nick-nagel.github.io/pages/about-nick.html">About Nick</a>
                    </li>
                    <li>
                        <a href="https://dr-nick-nagel.github.io/blog/index.html">Blog</a>
                    </li>
                    <li>
                        <a href="https://dr-nick-nagel.github.io/pages/nn-cv.html">CV</a>
                    </li>
                </ul>
            </navbar>
            <main class="content">
  <article>
    <header>
      <h2>
        <a href="https://dr-nick-nagel.github.io/blog/nesting-svgs.html" rel="bookmark"
           title="Permalink to More on SVG Viewports: Nesting SVG's">More on SVG Viewports: Nesting SVG's</a></h2>
      
    </header>
    <style>
.CodeList {
    background-color: #333;
    color: #FFE;
    padding: 5px;
    border: solid 1px black;
    border-radius: 5px;
    overflow: scroll;
    font-size: 10px;
}
.AlignCenter {
  text-align: center;
}

.CodeLine{
    font-family: monospace;
    font-size: smaller;
    font-weight: bold;
    color: #A00;
}


.ImageWrapper {
    display: block;
    margin-right:auto;
    margin-left:auto;
    border: inset grey 4px;
}

.GuideWrapper { 
  display: flex;
  align-items: center; /* Vertically aligns items in the center */
}

.GuidePost {
  margin-left: 10px; /* Adds some spacing between the image and the text */
}

</style>

<h1>Introduction</h1>
<p>Having been engaged recently in the development of a Scalable Vector Graphics (SVG) framework for artists (the SVG Artists Collaborative &trade;) I've come to appreciate more and more the creative benefits afforded to vector art by the SVG standard. Elsewhere I've discussed many aspects of the standard, especially those that relate to SVG transforms. In this post I want to focus mainly on one important aspect -- namely the capability and implications of nesting <code>svg</code> elements. </p>
<h1>Nesting SVG's</h1>
<p>The <code>&lt;svg&gt;</code> element is the top-level, or <em>root element</em> in an SVG document. The concept of a <em>root element</em> is particularly important in xml markup languages like SVG. It's also important in HTML. But what's interesting to me is that unlike HTML (where you can<em>not</em> nest the <code>&lt;html&gt;</code> element) nesting of <code>&lt;svg&gt;</code> elements is perfectly permissible. So what exactly does that mean? </p>
<style>
#russian_doll_1 {
  display: inline-block;
  float:   left;
  margin-right: 20px;
  border:  inset red 2px;
  background-color: #000;
}
</style>

<div id="russian_doll_1">
  <img 
    alt="Image: an animated Russian doll SVG graphic illustrating nesting by way of analogy."
    src="/svg/carousel/russian_doll_animation.svg"
  >
  </img>
</div>

<p>Nesting <code>&lt;svg&gt;</code>'s simply means you can put one or more <code>&lt;svg&gt;</code> elements inside another.</p>
<pre class="CodeFragment">
&lt;svg>
    &lt;svg>
        ...
    &lt;/svg>
    &lt;svg>
        &lt;svg>
            ...
        &lt;/svg>
        ...
    &lt;/svg>
&lt;/svg>
</pre>

<p>That's it. Pure and simple. Think of it like a Russian doll. Remember those? You have this beautiful craft piece -- an ornately decorated figure -- and you open it up and there's another one inside. And you open that up and there's another, and so on and so on. </p>
<p>Same thing with <code>&lt;svg&gt;</code> elements. You can nest these guys as deeply as you need. In principle the recursion can be infinite. </p>
<h1>What does Nesting SVG's Imply?</h1>
<p>That sounds easy enough. But what are the implications of nesting SVG's? And why am I so excited about it? Well, the capability to nest <code>&lt;svg&gt;</code> elements is very cool and carries with it several powerful benefits. Let's take a moment to examine them.</p>
<h4>Each SVG Has its Own ViewPort</h4>
<p><span id="return_1">First and foremost</span>, each <code>&lt;svg&gt;</code> gets its own <em>viewport</em>. Remember, the SVG viewport is like a window into your creative SVG space. You can control aspects of the viewport using the <code>viewBox</code> attribute in concert with <code>width</code> <code>height</code> and <code>preserveAspectRatio</code>. Each <code>svg</code> node will essentially have it's own independent <em>user coordinate system</em> opening up whole new avenues for creativity <sup><a href="#end_note_1">1</a></sup> . </p>
<h4>Standalone SVG Rendering Contexts</h4>
<p>Each SVG is inherently a standalone rendering context -- it's like its own canvas. This enables creators to design modular re-usable components (e.g., icons, charts, game backgrounds, characters, etc.) that can be shown in isolation and composited into larger figures and scenes. Importantly, the capability to nest SVG documents facilitates collaboration and the use of third-party components or illustrations.</p>
<h4>Built-in Aspect Ratio Control</h4>
<p>Nested <code>&lt;svg&gt;</code> elements respect <code>preserveAspectRatio</code> settings, allowing better control of layout and scaling behavior. This is incredibly useful in responsive web-design with flexible layouts. </p>
<h4>Isolation of CSS and styles</h4>
<p>A nested SVG can be isolated in terms of style scope. This makes it possible to create complex UIs where encapsulation is needed to prevent unintended inheritance or style bleed from parent SVG's or HTML.</p>
<h1>Demonstration: An SVG Carousel</h1>
<p>To demonstrate these powerful benefits I've created an SVG <em>carousel</em> for use within the SVG Artists Collaborative&trade;. Popular in web-deign and advertising, carousels are dynamic user-interface designs that can be used to showcase multiple pieces of content -- in this case nested SVG's. </p>
<style>

.CarouselWrap { 
  position: relative;
  display: flex; 
  justify-content: center; 
  align-items: center; 
  width: 550px; 
  height: 412.5px;
  background: #222; 
  flex-direction: column;
}


#fps_display {
  position: absolute; 
  bottom: 20px; 
  left: 100px; 
  color: rgb(212, 6, 6);
  font-family: monospace;
  font-size: 10px;
  text-align: left;
  font-weight: bold;
  pointer-events: none;
  padding: 5px;
}

svg { 
  border: 1px solid white; 
}

</style>
<div class="CarouselWrap">
    <svg id="carousel" 
         width="550" 
         height="412.5" 
         viewBox="-300 -100 800 400"
         >
        <!-- SVG Elements will be added dynamically -->
    </svg>
    <div id="fps_display">FPS: </div>
</div>

<p>The carousel comprises a root <code>&lt;svg&gt;</code> element, which defines its viewport and several nested standalone SVG images and animations. If you click on the carousel viewport, you should see it start revolving. Noticed how the positioning and animation of all the nested SVG's are preserved!</p>
<h1>Discussion</h1>
<p>The carousel demonstrates the power and artistry that can be achieved using the SVG nesting approach. Generally speaking a lot can be achieved simply by grouping SVG elements using <code>&lt;g&gt;</code> wrappers and applying transformations, but that can quickly become unwieldy and difficult to maintain for larger and more complex artworks. The capability to composite larger works through nesting offers so much greater flexibility and creative options over and above grouping that I hardly even know where to begin.</p>
<p>However, over the course of designing the component I did encounter a few gotchas which I feel obliged to address here. The biggest problem I had to work out concerns <em>stacking order</em> and overlapping displays. To explain, I'll examine some of the design and implementation details around the carousel</p>
<h2>Architecture</h2>
<p>The carousel architecture takes advantage of <code>&lt;svg&gt;</code> element nesting to dynamically display multiple embedded SVG documents. The documents are loaded dynamically and appended to the DOM composing the  structure shown in the following code fragment. </p>
<h4>Listing 1</h4>
<pre class="CodeList">
&lt;svg id="carousel" 
     width="550" 
     height="412.5" 
     viewBox="-300 -100 800 400">

    <span style="color:#8F8">&lt;g class="svg-slide-wrapper" 
       transform="..." 
       data-current-rotation="102" </span>
       <span style="color:red">data-depth="97.49279121818236"</span> <span style="color:#8F8">></span>

       &lt;svg id="svg_slide_1"
         width="300" height="170" viewBox="0 0 350 200" ... >
           ...
       &lt;/svg>

     <span style="color:#8F8">&lt;/g></span>

&lt;/svg>
</pre>

<p>The fragment (abridged for the sake of brevity) shows the nested structure of the SVG's. Note also the the use of <code>data-</code> attributes and wrapper <code>g</code> which I'll discuss below.</p>
<p>I achieved a faux 3D effect by revolving the carousel items (I called them "slides") on an elliptical path with major and minor axes on $x$ and $y$ respectively.</p>
<pre class="CodeList">
function revolveSvg ( svgGWrapper, theta ) {
    const radians = theta * (Math.PI / 180);
    let xTrans = carousel.SEMI_MAJOR_AXIS * Math.cos( radians ); 
    let yTrans = carousel.SEMI_MINOR_AXIS * Math.sin( radians ); 
    let scaleFactor = 0.25 + 0.15 * ( 1 + Math.sin( radians ) );
    svgGWrapper.setAttribute( 
        "transform", 
        `translate( ${xTrans} ${yTrans} ) scale( ${ scaleFactor } )` 
    );
    svgGWrapper.setAttribute( "data-current-rotation", theta );
    svgGWrapper.setAttribute( "data-depth", yTrans );
}
</pre>

<p>To complete the effect I used a simple heuristic -- scaling down the svg as a function of "depth" (really just $y$) to make them appear smaller and more distant the higher they are in the parent viewport. </p>
<h2>And You Thought it'd be that Easy ... gotcha!</h2>
<p>And now for the gotchas. Ever the optimist, when I conceived this demo I figured I could hammer it out before lunch. Sadly -- the devil's in the details and I got caught by a couple of "gotchas" that dragged out the timeline a bit.</p>
<h3>SVG Stacking</h3>
<p>SVG elements are declared hierarchically and displayed in the order they're declared. In cases of overlap that means that elements declared subsequent to earlier elements in document order will hide portions of those earlier elements where they overlap. </p>
<p>For example if I have: </p>
<pre class="CodeList">
&lt;svg id="carousel" 
     width="550" 
     height="412.5" 
     viewBox="-300 -100 800 400">

    &lt;g ...>
       &lt;svg <span style="color:red">id="svg_slide_1"</span> ... >
           ...
       &lt;/svg>
     &lt;/g>

    &lt;g ...>
       &lt;svg <span style="color:#8F8">id="svg_slide_2"</span> ... >
           ...
       &lt;/svg>
    &lt;/g>

    ...

&lt;/svg>
</pre>

<p>And <code>svg_slide_2</code> overlaps <code>svg_slide_1</code> then <code>svg_slide_2</code> will hide the portion of <code>svg_slide_1</code> with which it overlaps. The problem with the carousel is that as it revolves items have to overlap correctly to to give that 2.5D effect. I must confess, the 'gotcha' for me was I didn't initially visualize that in my mind's eye when I conceived the design. </p>
<p>At this point if you're versed in CSS you might be thinking "well just set the z-index". 'Problem is, SVG doesn't have the concept of a z-index.  And for this demo I was after a pure SVG solution. So I opted for an alternative approach, namely:</p>
<ol>
<li>
<p>Periodically compute the stacking order based a "distance heuristic", and</p>
</li>
<li>
<p>Sort and shuffle the nested SVG's as needed.</p>
</li>
</ol>
<pre class="CodeList">
const sortSlides = ( a, b ) => {
    const aDepth = a.getAttribute( <span style="color:red">"data-depth"</span> );
    const bDepth = b.getAttribute( <span style="color:red">"data-depth"</span> );
    return ( aDepth - bDepth ) ;
};

/**
 * Restack the slides to INSURE THAT OVERLAPPING
 * ELEMENTS ARE DISPLAYED CORRECTLY TO PRESERVE THE
 * ILLUSION OF DEPTH...
 */
const reStackSlides = () => {
    let stack = Array.from(
        carouselGroup.querySelectorAll('.svg-slide-wrapper')
    );
    stack.sort( sortSlides );
    carouselGroup.innerHTML = "";
    for( let slide of stack ) {
        carouselGroup.append( slide );
    }
 }
</pre>

<p>If you take a moment to look at the listing you'll notice I store the depth information as an attribute on the SVG XML. I've been a fan of utilizing data- attributes since they were introduced in HTML5 and I find them particularly useful working with SVG.</p>
<div class="admonition tip">
<p class="admonition-title">Pro Tip</p>
<p>Use <code>data-</code> attributes to store small bits of info if you need to work on SVG DOM elements.</p>
</div>
<h3>Performance</h3>
<p>Now if you're worried about performance at this point (I know I certainly was) your fear wouldn't be misplaced. It seems like a lot of DOM manipulation going on now. But, again -- nested <code>&lt;svg&gt;</code>'s to the rescue. The nested SVG DOM's don't have to be re-parsed and computed on the shuffle and the re-indexing didn't have much impact. <span id="return_2">Even with non-trivially complex SVG's like the biome animation</span> <sup><a href="#end_note_2">2</a></sup> the carousel has no problem hitting the 60FPS target I usually aim for. And that's on my aging linux box. On my Samsung phone the carousel does 130 FPS or better.</p>
<h2>Browser Considerations</h2>
<p>The second thing that got me has to do with browser differences. I originally hammered out the carousel iteratively testing in Firefox. Over the course of doing so I applied the carousel transforms directly on the nested <code>&lt;svg&gt;</code>'s and everything worked as I expected. Buuut when I went and tested on Chrome at the end of the day I had a bit of a surprise. Chrome was not applying the transformations as expected to the nested <code>&lt;svg&gt;</code>s. Here's the story ...</p>
<p><span id="return_3">The way transforms like <code>translate</code>, <code>rotate</code> etc. work in SVG is they are applied to an element and inherited by it's children such that as you work your way down the SVG DOM you get a cumulative effect <sup><a href="#end_note_3">3</a></sup>  </span><ENDNOTE REF TO HELL> . But sadly in SVG 1.1 the <code>transform</code> attribute was not explicitly permitted on <code>&lt;svg&gt;</code>. That changed in SVG 2.</p>
<p>All that being said it looks like there are still browser differences with respect to compliance with the spec (not something I expected in 2025) and Chrome did not apply the transformations as expected. </p>
<p>The good news is there's a straight forward work around: *wrap the nested SVG's in a <code>&lt;g&gt;</code> element if you need to apply transformations. The enclosing <code>&lt;g&gt;</code>'s will be in the containing <code>&lt;svg&gt;</code>'s scope and Chrome respects that and applies them to the nested <code>&lt;svg&gt;</code>'s.</p>
<p>The bottom line is that's why we still need to test in every target browser and device.</p>
<h1>Conclusion</h1>
<p>So that brings us to the conclusion of this post. I sincerely hope you've found it educational and useful. But most of all, I hope you come away from this inspired to continue exploring SVG and all that it provides toward enabling the creation of beautiful artworks. </p>
<h1>Endnotes</h1>
<ol>
<li>
<p><span id="end_note_1">I've written in greater depth about <code>viewports</code> -- specifically with regard to <a href="https://dr-nick-nagel.github.io/blog/trans-matrix.html">here</a> for those interested more details <a href='#return_1'><img src='/svg/return_to_text.svg'></a>  .</span></p>
</li>
<li>
<p><span id="end_note_2">Special thanks to Tyhond (an SVG Artist's Collaborative member) for permission to use his <a href="https://tyhond.newgrounds.com/">biome</a> for this article <a href='#return_2'><img src='/svg/return_to_text.svg'></a> .</span></p>
</li>
<li>
<p><span id="end_note_3">For more details on deconvolving SVG transformations using the matrix <a href="https://dr-nick-nagel.github.io/blog/svg-transform-matrix.html">visit...</a> <a href='#return_3'><img src='/svg/return_to_text.svg'></a>  </span>.</p>
</li>
</ol>
<h1>Resources</h1>
<ol>
<li>
<p><a href="https://www.w3.org/TR/SVG2/struct.html#NewDocument">Defining an SVG document fragment: the <code>svg</code> element</a></p>
</li>
<li>
<p><a href="https://www.sarasoueidan.com/blog/nesting-svgs/">Understanding SVG Coordinate Systems and Transformations (Part 3) -- Establishing New Viewports</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/16890292/why-nest-an-svg-element-inside-another-svg-element">Stack Overflow: Why nest an <code>&lt;svg&gt;</code> element inside another <code>&lt;svg&gt;</code> element?</a></p>
</li>
</ol>
    <footer>
      <p>Published: <time datetime="2025-03-17T00:00:00-04:00">
        Mon 17 March 2025
      </time></p>
        <address>
          By             <a href="https://dr-nick-nagel.github.io/author/nick-nagel.html">Nick Nagel</a>
        </address>
        <p>
          Category: <a href="https://dr-nick-nagel.github.io/category/blog.html">blog</a>
        </p>
        <p>
          Tags:
            <a href="https://dr-nick-nagel.github.io/tag/javascript.html">javascript</a>
            <a href="https://dr-nick-nagel.github.io/tag/animation.html">animation</a>
            <a href="https://dr-nick-nagel.github.io/tag/svg.html">svg</a>
            <a href="https://dr-nick-nagel.github.io/tag/scalable-vector-graphics.html">scalable vector graphics</a>
            <a href="https://dr-nick-nagel.github.io/tag/art.html">art</a>
            <a href="https://dr-nick-nagel.github.io/tag/artwork.html">artwork</a>
            <a href="https://dr-nick-nagel.github.io/tag/html5.html">HTML5</a>
            <a href="https://dr-nick-nagel.github.io/tag/artworks.html">artworks</a>
            <a href="https://dr-nick-nagel.github.io/tag/framework.html">framework</a>
            <a href="https://dr-nick-nagel.github.io/tag/svg-arists-collaborative.html">SVG Arists Collaborative</a>
            <a href="https://dr-nick-nagel.github.io/tag/inkscape.html">Inkscape</a>
            <a href="https://dr-nick-nagel.github.io/tag/illustrator.html">Illustrator</a>
            <a href="https://dr-nick-nagel.github.io/tag/adobe.html">Adobe</a>
        </p>
    </footer>
  </article>
                <footer>
                    <hr />
                    <div class="footer_content">
Now built with <a rel="nofollow" href="https://getpelican.com/"><em>Pelican</em></a>,
which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                    </div>
                    <div class="copyright">
&copy; 1999-<span id="current-year"></span> Harold Nicholas Nagel. All rights reserved.  
                    </div>
                    <script>
document.getElementById("current-year").textContent = new Date().getFullYear();
                    </script>
                </footer>
            </main>
        </div>
    </body>
    
    
</html>