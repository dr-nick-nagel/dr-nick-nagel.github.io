<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Separating Axis Theorem Illustrated</title>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script 
        id="MathJax-script" 
        async 
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <style>
        body {
            margin: 0;
        }
        div.Math {
            color: #000;
            font-size: 4px;
            background-color: #fefefe;
            box-shadow: 0px 2px 2px rgba( 0, 0, 0, 0.5 );
            padding-top:  2px;
            padding-left: 2px;
            padding-right: 2px;
            max-width: 35px;
            marign-top:-2px;
        }
        foreignObject {
            
        }
        #triangle_B_group{
            cursor: grab;
        }
        .fadeable {
            opacity: 0;
            transition: opacity 2s ease;
        }
        .fadeable.visible {
            opacity: 0.7;
        }

    </style>
</head>
<body>
    <svg id='fig_1_svg'
        version="1.1" 
        xmlns="http://www.w3.org/2000/svg" 
        xmlns:xlink="http://www.w3.org/1999/xlink" 
        width="300" 
        height="300" 
        viewBox="-3 -8 10 10"
    >
        <defs id="coordinates">
            <g id="world-axes" stroke="#999999" stroke-width="0.02">
                <line x1="-10" y1="0" x2="10" y2="0" />
                <line x1="0" y1="-10" x2="0" y2="10" />
                <g id="unit-ticks" stroke="#666666" stroke-width="0.02">
                    <line x1="-10" y1="0.05" x2="-10" y2="-0.05" />
                    <line x1="-9" y1="0.05" x2="-9" y2="-0.05" />
                    <line x1="-8" y1="0.05" x2="-8" y2="-0.05" />
                    <line x1="-7" y1="0.05" x2="-7" y2="-0.05" />
                    <line x1="-6" y1="0.05" x2="-6" y2="-0.05" />
                    <line x1="-5" y1="0.05" x2="-5" y2="-0.05" />
                    <line x1="-4" y1="0.05" x2="-4" y2="-0.05" />
                    <line x1="-3" y1="0.05" x2="-3" y2="-0.05" />
                    <line x1="-2" y1="0.05" x2="-2" y2="-0.05" />
                    <line x1="-1" y1="0.05" x2="-1" y2="-0.05" />
                    <line x1="1" y1="0.05" x2="1" y2="-0.05" />
                    <line x1="2" y1="0.05" x2="2" y2="-0.05" />
                    <line x1="3" y1="0.05" x2="3" y2="-0.05" />
                    <line x1="4" y1="0.05" x2="4" y2="-0.05" />
                    <line x1="5" y1="0.05" x2="5" y2="-0.05" />
                    <line x1="6" y1="0.05" x2="6" y2="-0.05" />
                    <line x1="7" y1="0.05" x2="7" y2="-0.05" />
                    <line x1="8" y1="0.05" x2="8" y2="-0.05" />
                    <line x1="9" y1="0.05" x2="9" y2="-0.05" />
                    <line x1="10" y1="0.05" x2="10" y2="-0.05" />
                    <line x1="-0.05" y1="-9" x2="0.05" y2="-9" />
                    <line x1="-0.05" y1="-8" x2="0.05" y2="-8" />
                    <line x1="-0.05" y1="-7" x2="0.05" y2="-7" />
                    <line x1="-0.05" y1="-6" x2="0.05" y2="-6" />
                    <line x1="-0.05" y1="-5" x2="0.05" y2="-5" />
                    <line x1="-0.05" y1="-4" x2="0.05" y2="-4" />
                    <line x1="-0.05" y1="-3" x2="0.05" y2="-3" />
                    <line x1="-0.05" y1="-2" x2="0.05" y2="-2" />
                    <line x1="-0.05" y1="-1" x2="0.05" y2="-1" />
                    <line x1="-0.05" y1="1" x2="0.05" y2="1" />
                    <line x1="-0.05" y1="2" x2="0.05" y2="2" />
                    <line x1="-0.05" y1="3" x2="0.05" y2="3" />
                    <line x1="-0.05" y1="4" x2="0.05" y2="4" />
                    <line x1="-0.05" y1="5" x2="0.05" y2="5" />
                    <line x1="-0.05" y1="6" x2="0.05" y2="6" />
                    <line x1="-0.05" y1="7" x2="0.05" y2="7" />
                    <line x1="-0.05" y1="8" x2="0.05" y2="8" />
                    <line x1="-0.05" y1="9" x2="0.05" y2="9" />
                </g>
            </g>
            <marker id="arrow_triangle" 
                markerWidth="0.5" 
                markerHeight="0.5" 
                refX="0" 
                refY="0.25" 
                orient="auto" 
                markerUnits="userSpaceOnUse">
                <path d="M0,0 L0.5,0.25 L0,0.5 L0,0" fill="#0066cc" />
            </marker>
            <marker id="arrowhead"  
                refX="0"
                refY="0"
                markerWidth ="1"
                markerHeight="1" 
                viewBox="-0.5 -0.5 1 1"
                markerUnits="userSpaceOnUse"
                orient="auto"
                color="inherit"
            >
                <path d="M0,0 L-0.2,-0.2 L 0.4,0 L-0.2,0.2 L0,0" 
                    fill="context-stroke"/>
            </marker>
            <!-- BEZIER PATHS -->
            <path 
                d="M 0 0 C 1 0, 2 1, 3 1"  
                stroke="blue" 
                fill="none" 
                stroke-width="0.1"
                marker-end="url(#arrow_triangle)"/> 
            <path id="curved_pointer"
                d="M 3 -2.5 C 2 -5, 0 -5, -2 -5"  
                stroke="blue" 
                fill="none" 
                stroke-width="0.1"
                marker-end="url(#arrowhead)"/>
                
            <!-- PROJECTIONS -->
            <g>
                <line 
                    x1="0" y1="-2" x2="0" y2="-6"
                    stroke="rgba(0, 102, 204, 0.5)" 
                    stroke-width="0.3" 
                />
                <line 
                    x1="0" y1="0" x2="0" y2="-4"
                    stroke="rgba(255, 51, 0, 0.5)" 
                    stroke-width="0.3" 
                />
                <line 
                    x1="18" y1="9" x2="10" y2="5"
                    stroke="rgba(0, 102, 204, 0.5)" 
                    stroke-width="0.3" 
                />
                <line 
                    x1="8" y1="4" x2="0" y2="0"
                    stroke="rgba(255, 51, 0, 0.5)" 
                    stroke-width="0.3" 
                />
            </g>
            <!-- ANIMATIONS -->
            <animateTransform
                attributeName="transform"
                type="rotate"
                from="0 0 0"
                to="90 0 0"
                dur="1s"
                additive="sum"
                begin="indefinite"
                fill="freeze"
            />
            <animateTransform
                attributeName="transform"
                type="translate"
                additive="sum"
                from="3 -1"
                to="-2 -1"
                dur="2s"
                fill="freeze" />
            <animate
                attributeName="x2"
                from="2"
                to="7"
                dur="2s"
                fill="freeze" />
        </defs>
        <g id="background">
            <rect x="-10" y="-10" width="20" height="20" fill="#eee" stroke="none" />
        </g>
        <use xlink:href="#world-axes"  />
        <g id='triangles_group'>
            <g id="triangle_A_group" >
                <polygon id='triangle_A'
                    points="0,0 2,0 1,-2" 
                    fill="#ff3300" 
                    stroke="#7e1c04" 
                    stroke-width="0.05" />
                <text x="1" y="-0.5" 
                    font-size="1px"
                    fill=#7e1c04
                    text-anchor="middle"
                    dominant-baseline="middle"
                    >A</text> 
                <text x="-0.2" y="0.1" 
                    font-size="0.5px"
                    fill=#7e1c04
                    text-anchor="middle"
                    dominant-baseline="middle"
                    >1</text>
                <text x="2.2" y="0.1" 
                    font-size="0.5px"
                    fill=#7e1c04
                    text-anchor="middle"
                    dominant-baseline="middle"
                    >2</text>
                <text x="1" y="-2.4" 
                    font-size="0.5px"
                    fill=#7e1c04
                    text-anchor="middle"
                    dominant-baseline="middle"
                    >3</text>
            </g>
            <g id="triangle_B_group" >
                <polygon id='triangle_B'
                    points="3,-1 5,-1 4,-3" 
                    fill="#99ccff" 
                    stroke="#0066cc" 
                    stroke-width="0.05" />
                <text x="4" y="-1.5" 
                    font-size="1px"
                    fill=#0066cc
                    text-anchor="middle"
                    dominant-baseline="middle"
                    >B</text>
                <text x="2.8" y="-1" 
                    font-size="0.5px"
                    fill=#0066cc
                    text-anchor="middle"
                    dominant-baseline="middle"
                    >1</text>
                <text x="5.2" y="-1" 
                    font-size="0.5px"
                    fill=#0066cc
                    text-anchor="middle"
                    dominant-baseline="middle"
                    >2</text>
                <text x="4" y="-3.4" 
                    font-size="0.5px"
                    fill=#0066cc
                    text-anchor="middle"
                    dominant-baseline="middle"
                    >3</text>
            </g>
        </g>
        <g transform="translate(3, -1)">
            <animateTransform id="create_basis"
                attributeName="transform"
                type="translate"
                from="3 -1"
                to="-2 0"
                dur="2s"
                fill="freeze" 
                begin="indefinte"/>
            <g transform="rotate(0)">
                <animateTransform  id="normal"
                    attributeName="transform"
                    type="rotate"
                    from="0 0 0"
                    to="-90 0 0"
                    dur="0.5s"
                    fill="freeze" 
                    begin="indefinte"/>
                <line id='n_1'
                    x1="0" y1="0" x2="2" y2="0"
                    stroke="#0066cc" 
                    stroke-width="0.1" 
                    opacity='0'
                    marker-end="url(#arrowhead)">
                    <animate id="lengthenX2"
                        attributeName="x2"
                        from="2"
                        to="7"
                        dur="2s"
                        fill="freeze" 
                        begin="indefinte"/>
                    <animate id="lengthenX1"
                        attributeName="x1"
                        from="0"
                        to="-0.5"
                        dur="2s"
                        fill="freeze" 
                        begin="indefinte"/>
                    <animate id="fade_in_edge"
                        attributeName="opacity"
                        from="0"
                        to="1"
                        dur="2s"
                        fill="freeze"
                        begin="indefinte"/>
                </line>
            </g>
        </g>
        <g transform="translate(3, -1)">
            <animateTransform id="create_basis_2"
                attributeName="transform"
                type="translate"
                from="3 -1"
                to="-1 0"
                dur="2s"
                fill="freeze" 
                begin="indefinte"/>
            <g transform="rotate(-63.44)">
                <animateTransform  id="normal_2"
                    attributeName="transform"
                    type="rotate"
                    from="-63.44 0 0"
                    to="-153.44 0 0"
                    dur="0.5s"
                    fill="freeze" 
                    begin="indefinte"/>
                <animateTransform  id="basis_2_rotate"
                    attributeName="transform"
                    type="rotate"
                    from="-153.44 0 0"
                    to="-90 0 0"
                    dur="0.5s"
                    fill="freeze" 
                    begin="indefinte"/>
                <line id='n_2'
                    x1="0" y1="0" x2="2" y2="0"
                    stroke="#0066cc" 
                    stroke-width="0.1" 
                    opacity='0'
                    marker-end="url(#arrowhead)">
                    <animate id="lengthenX2_2"
                        attributeName="x2"
                        from="2"
                        to="10"
                        dur="2s"
                        fill="freeze" 
                        begin="indefinte"/>
                    <animate id="lengthenX1_2"
                        attributeName="x1"
                        from="0"
                        to="-0.5"
                        dur="2s"
                        fill="freeze" 
                        begin="indefinte"/>
                    <animate id="fade_in_edge_2"
                        attributeName="opacity"
                        from="0"
                        to="1"
                        dur="2s"
                        fill="freeze"
                        begin="indefinte"/>
                </line>
            </g>
        </g>
        <g id='projections_group' 
            opacity="0"
            transform="translate(-1.8 0.25)">
            <animate id="fade_in"
                attributeName="opacity"
                from="0"
                to="1"
                dur="2s"
                fill="freeze"
                begin="indefinte"/>
            <g id='projections_g_2'>
                <animate id="fade_out_proj"
                    attributeName="opacity"
                    from="1"
                    to="0"
                    dur="2s"
                    fill="freeze"
                    begin="indefinte"/>
                <polygon id='b_projection'
                    points="3,-1 4,-3 -1.65,-5.7 -1.67,-1.75" 
                    fill="#99ccff"
                    stroke="none"
                    opacity="0.2"
                    transform="translate(1.8 -0.25)"
                    />
                <polygon id='a_projection'
                    points="0,0 1,-2 -1.65,-3.67 -1.65,0.30" 
                    fill="#ff3300"
                    stroke="none"
                    opacity="0.2"
                    transform="translate(1.8 -0.25)"
                    />
            </g>
            <line id='p_1'
                x1="0" y1="-2" x2="0" y2="-6"
                stroke="rgba(0, 102, 204, 0.5)" 
                stroke-width="0.3" 
            />
            <line id='p_2'
                x1="0" y1="0" x2="0" y2="-4"
                stroke="rgba(255, 51, 0, 0.5)" 
                stroke-width="0.3" 
            />
        </g>
        <g id='projections_group_gap' 
            opacity="0"
        >
            <animate id="fade_in_2"
                attributeName="opacity"
                from="0"
                to="1"
                dur="2s"
                fill="freeze"
                begin="indefinte"/>
            <g id='projections_gap_2'>
                <animate id="fade_out_proj_2"
                    attributeName="opacity"
                    from="1"
                    to="0"
                    dur="2s"
                    fill="freeze"
                    begin="indefinte"/>
                <polygon id='b_projection'
                    points="3,-1 4,-3 -0.65,-10 -0.67,-4.75" 
                    fill="#99ccff"
                    stroke="none"
                    opacity="0.2"
                    />
                <polygon id='a_projection'
                    points="0,0 1,-2 -0.65,-3.67 -0.65,0.30"
                    fill="#ff3300"
                    stroke="none"
                    opacity="0.2"
                    />                 
            </g>
            <g transform="translate(-0.8 0.25) scale(1, 1)">
                <line id='p_3'
                    x1="0" y1="-5" x2="0" y2="-9"
                    stroke="rgba(0, 102, 204, 0.5)" 
                    stroke-width="0.3" 
                />
                <line id='p_4'
                    x1="0" y1="0" x2="0" y2="-4"
                    stroke="rgba(255, 51, 0, 0.5)" 
                    stroke-width="0.3" 
                />
            </g>
        </g>
        <g id="normal_formula" 
            class="fadeable"
            transform="scale(0.1)">
            <foreignObject x="10" y="-55" width="35" height="15">
                <div xmlns="http://www.w3.org/1999/xhtml" 
                    class="Math"
                >$\vec{n} = (-y,\; x)$</div>
            </foreignObject>
        </g>
        <g id="projection_formula" 
            class="fadeable"
            transform="scale(0.1)">
            <foreignObject x="10" y="-55" width="55" height="15">
                <div xmlns="http://www.w3.org/1999/xhtml" 
                    class="Math"
                >$\text{proj}( V) = V \cdot \vec n$</div>
            </foreignObject>
        </g>
    </svg>

<script >


// helper dev time
function createSvgCoordsFinder( svg ) {
  return function( evt ) {
      let pt = svg.createSVGPoint();
      pt.x = evt.clientX;
      pt.y = evt.clientY;
      let transformed = pt.matrixTransform(
          svg.getScreenCTM().inverse()
      );

  };
}

document.addEventListener(
    "DOMContentLoaded",
    (evt) => {
        const svgRoot = document.getElementById("fig_1_svg");

        document.addEventListener(
            "click",
            createSvgCoordsFinder( svgRoot )
        );

        const touchHandler = document.getElementById( "triangle_B_group" );
        const steps = {
            AXIS_SELECT : 0,
            NORMAL :      1,
            BASIS :       2,
            PROJECT :     3,
            AXIS_SELECT_2 : 4,
            NORMAL_2 :      5,
            BASIS_2 :       6,
            PROJECT_2 :     7,
        };
        const animations = {
            createBasis : document.getElementById ( "create_basis" ) ,
            normal      : document.getElementById ( "normal" ) ,
            lengthenX2  : document.getElementById ( "lengthenX2" ) ,
            lengthenX1  : document.getElementById ( "lengthenX1" ) ,
            project     : document.getElementById ( "fade_in" ) ,
            fadeInEdge  : document.getElementById ( "fade_in_edge" ) ,
            fadeOutProj : document.getElementById ( "fade_out_proj" ) ,
            createBasis2 : document.getElementById ( "create_basis_2" ) ,
            normal2      : document.getElementById ( "normal_2" ) ,
            lengthenX2_2  : document.getElementById ( "lengthenX2_2" ) ,
            lengthenX1_2  : document.getElementById ( "lengthenX1_2" ) ,
            project2     : document.getElementById ( "fade_in_2" ) ,
            fadeInEdge2  : document.getElementById ( "fade_in_edge_2" ) ,
            fadeOutProj2 : document.getElementById ( "fade_out_proj_2" ) ,
            rotateBais2 : document.getElementById ( "basis_2_rotate" ) ,
        };
        let state = -1;
        touchHandler.addEventListener( 
            "click",
            (evt ) => {
               state += 1; 
               switch( state ) {
                  case steps.AXIS_SELECT :
                      animations.fadeInEdge.beginElement();

                      break;
                  case steps.NORMAL :
                      animations.normal.beginElement();
                      document.getElementById("normal_formula").classList.add( "visible" );

                      break;
                  case steps.BASIS :
                      document.getElementById("normal_formula").classList.remove( "visible" );
                      animations.createBasis.beginElement();
                      animations.lengthenX2.beginElement();
                      animations.lengthenX1.beginElement();

                      break;
                  case steps.PROJECT :
                      animations.project.beginElement();
                      document.getElementById("projection_formula").classList.add( "visible" );
                      setTimeout( 
                          () => {
                            animations.fadeOutProj.beginElement();
                          },
                          5000
                      );

                      break;
                  case steps.AXIS_SELECT_2 :
                      document.getElementById("projection_formula").classList.remove( "visible" );
                      animations.fadeInEdge2.beginElement();

                      break;
                  case steps.NORMAL_2 :
                      animations.normal2.beginElement();
                      document.getElementById("normal_formula").classList.add( "visible" );

                      break;
                  case steps.BASIS_2 :
                      document.getElementById("normal_formula").classList.remove( "visible" );
                      animations.createBasis2.beginElement();
                      animations.lengthenX2_2.beginElement();
                      animations.lengthenX1_2.beginElement();
                      animations.rotateBais2.beginElement();

                      break;
                  case steps.PROJECT_2 :
                      animations.project2.beginElement();
                      document.getElementById("projection_formula").classList.add( "visible" );
                      setTimeout( 
                          () => {
                            animations.fadeOutProj2.beginElement();
                          },
                          5000
                      );

                      break;
                  default:

                      state = 8;
               }
            }
        );
    }
); 
</script>

</body>
</html>
